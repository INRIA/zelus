(* test of a simple two-state automaton *)
let node f1() returns (o init 42, c1, c2)
  do c1 = last o = 45
  and c2 = last o = 38
  and automaton
  | One -> do o = last o + 1 unless c1 then Two
  | Two -> do o = last o - 1 unless c2 then Three
  | Three -> do done
  end
  done
      
let node f2() returns (o)
  do o = 43 fby 44
      fby 45 fby 44 fby 43
      fby 42 fby 41 fby 40
      fby 39 fby 38 done
    
let node main() returns (o, o1, o2)
    do o1, _, _ = run f1() and o2 = run f2() and o = o1 = o2 done

