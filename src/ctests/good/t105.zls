
let hybrid f (r) = h where
  rec init h = 0.0
  and automaton
      | S0(hi) -> do h = hi done
      | S1(ti) -> do until r then S0(ti)
  init S1(0.0)
